<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÑàÍµ¨Î¶¨ Í≤åÏûÑ - Î†àÌä∏Î°ú ÏïÑÏºÄÏù¥Îìú</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        .input-field {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            font-size: 18px;
            border: 2px solid #FFD700;
            border-radius: 8px;
            background: white;
            color: #1a1a2e;
        }
        .leaderboard-container {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(to right, #ffd700, #ffa500);
            border-radius: 8px;
            color: #1a1a2e;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Firebase ÏÑ§Ï†ï (Ïó¨Í∏∞Ïóê Î≥∏Ïù∏Ïùò Firebase ÏÑ§Ï†ïÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî)
        const firebaseConfig = {
            apiKey: "AIzaSyDTX-7zcbVROR5h5NipAi8O7EJ3LySukxQ",
  authDomain: "racoon-be170.firebaseapp.com",
  databaseURL: "https://racoon-be170-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "racoon-be170",
  storageBucket: "racoon-be170.firebasestorage.app",
  messagingSenderId: "300248033090",
  appId: "1:300248033090:web:e4825b5333bac977814adb"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        const RaccoonGame = () => {
            const GRID_SIZE = 15;
            const CELL_SIZE = 40;
            
            const [gameState, setGameState] = useState('login'); // login, menu, playing, won, lost, leaderboard
            const [level, setLevel] = useState(1);
            const [score, setScore] = useState(0);
            const [lives, setLives] = useState(3);
            const [playerPos, setPlayerPos] = useState({ x: 1, y: 1 });
            const [fruits, setFruits] = useState([]);
            const [tacks, setTacks] = useState([]);
            const [invincible, setInvincible] = useState(false);
            
            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥
            const [userName, setUserName] = useState('');
            const [studentId, setStudentId] = useState('');
            const [currentUser, setCurrentUser] = useState(null);
            
            // ÏàúÏúÑÌëú
            const [leaderboard, setLeaderboard] = useState([]);

            // ÏàúÏúÑÌëú Î∂àÎü¨Ïò§Í∏∞
            const loadLeaderboard = useCallback(() => {
                database.ref('leaderboard').orderByChild('score').limitToLast(20).once('value', (snapshot) => {
                    const data = [];
                    snapshot.forEach((child) => {
                        data.push({ id: child.key, ...child.val() });
                    });
                    setLeaderboard(data.reverse());
                });
            }, []);

            // Ï†êÏàò Ï†ÄÏû•
            const saveScore = useCallback(() => {
                if (currentUser && score > 0) {
                    const scoreData = {
                        name: currentUser.name,
                        studentId: currentUser.studentId,
                        score: score,
                        level: level,
                        timestamp: Date.now(),
                        date: new Date().toLocaleString('ko-KR')
                    };
                    
                    database.ref('leaderboard').push(scoreData).then(() => {
                        loadLeaderboard();
                    });
                }
            }, [currentUser, score, level, loadLeaderboard]);

            // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
            const handleLogin = () => {
                if (userName.trim() && studentId.trim()) {
                    setCurrentUser({
                        name: userName.trim(),
                        studentId: studentId.trim()
                    });
                    setGameState('menu');
                } else {
                    alert('Ïù¥Î¶ÑÍ≥º ÌïôÎ≤àÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                }
            };

            // Î°úÍ∑∏ÏïÑÏõÉ
            const handleLogout = () => {
                setCurrentUser(null);
                setUserName('');
                setStudentId('');
                setGameState('login');
                setScore(0);
                setLevel(1);
                setLives(3);
            };

            // Î†àÎ≤® Ï¥àÍ∏∞Ìôî
            const initLevel = useCallback((levelNum) => {
                const newFruits = [];
                const newTacks = [];
                
                const fruitCount = 5 + levelNum * 2;
                for (let i = 0; i < fruitCount; i++) {
                    let pos;
                    do {
                        pos = {
                            x: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1,
                            y: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1
                        };
                    } while (
                        (pos.x === 1 && pos.y === 1) ||
                        newFruits.some(f => f.x === pos.x && f.y === pos.y)
                    );
                    newFruits.push(pos);
                }
                
                const tackCount = 8 + levelNum * 3;
                for (let i = 0; i < tackCount; i++) {
                    let pos;
                    do {
                        pos = {
                            x: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1,
                            y: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1
                        };
                    } while (
                        (pos.x === 1 && pos.y === 1) ||
                        newFruits.some(f => f.x === pos.x && f.y === pos.y) ||
                        newTacks.some(t => t.x === pos.x && t.y === pos.y)
                    );
                    newTacks.push(pos);
                }
                
                setFruits(newFruits);
                setTacks(newTacks);
                setPlayerPos({ x: 1, y: 1 });
            }, []);

            // Í≤åÏûÑ ÏãúÏûë
            const startGame = () => {
                setGameState('playing');
                setLevel(1);
                setScore(0);
                setLives(3);
                initLevel(1);
            };

            // ÌÇ§Î≥¥Îìú Ï°∞Ïûë
            useEffect(() => {
                if (gameState !== 'playing') return;

                const handleKeyPress = (e) => {
                    const { x, y } = playerPos;
                    let newX = x;
                    let newY = y;

                    switch(e.key) {
                        case 'ArrowUp':
                            newY = Math.max(0, y - 1);
                            break;
                        case 'ArrowDown':
                            newY = Math.min(GRID_SIZE - 1, y + 1);
                            break;
                        case 'ArrowLeft':
                            newX = Math.max(0, x - 1);
                            break;
                        case 'ArrowRight':
                            newX = Math.min(GRID_SIZE - 1, x + 1);
                            break;
                        default:
                            return;
                    }

                    e.preventDefault();
                    setPlayerPos({ x: newX, y: newY });
                };

                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [playerPos, gameState]);

            // Ï∂©Îèå Ï≤¥ÌÅ¨ Î∞è ÏïÑÏù¥ÌÖú ÏàòÏßë
            useEffect(() => {
                if (gameState !== 'playing') return;

                // Í≥ºÏùº ÏàòÏßë Ï≤¥ÌÅ¨
                const fruitIndex = fruits.findIndex(f => f.x === playerPos.x && f.y === playerPos.y);
                if (fruitIndex !== -1) {
                    setFruits(fruits.filter((_, i) => i !== fruitIndex));
                    setScore(score + 100);
                    
                    // Î™®Îì† Í≥ºÏùº ÏàòÏßë Ïãú Îã§Ïùå Î†àÎ≤®
                    if (fruits.length === 1) {
                        setTimeout(() => {
                            setLevel(level + 1);
                            initLevel(level + 1);
                            setScore(score + 500);
                        }, 300);
                    }
                }

                // ÏïïÏ†ï Ï∂©Îèå Ï≤¥ÌÅ¨
                if (!invincible) {
                    const hitTack = tacks.some(t => t.x === playerPos.x && t.y === playerPos.y);
                    if (hitTack) {
                        setLives(lives - 1);
                        setInvincible(true);
                        
                        if (lives <= 1) {
                            setGameState('lost');
                            saveScore();
                        } else {
                            setTimeout(() => {
                                setInvincible(false);
                            }, 1000);
                        }
                    }
                }
            }, [playerPos, fruits, tacks, gameState, score, lives, level, invincible, initLevel, saveScore]);

            // ÏàúÏúÑÌëú Î≥¥Í∏∞
            const showLeaderboard = () => {
                loadLeaderboard();
                setGameState('leaderboard');
            };

            // Í≤åÏûÑ ÌôîÎ©¥ Î†åÎçîÎßÅ
            const renderGrid = () => {
                const cells = [];
                
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        const isPlayer = playerPos.x === x && playerPos.y === y;
                        const isFruit = fruits.some(f => f.x === x && f.y === y);
                        const isTack = tacks.some(t => t.x === x && t.y === y);
                        const isWall = x === 0 || y === 0 || x === GRID_SIZE - 1 || y === GRID_SIZE - 1;
                        
                        cells.push(
                            React.createElement('div', {
                                key: `${x}-${y}`,
                                style: {
                                    width: CELL_SIZE,
                                    height: CELL_SIZE,
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontSize: '24px',
                                    backgroundColor: isWall ? '#8B4513' : '#90EE90',
                                    border: '1px solid #006400',
                                    opacity: invincible && isPlayer ? (Date.now() % 400 < 200 ? 0.3 : 1) : 1,
                                }
                            },
                                isPlayer && 'ü¶ù',
                                isFruit && 'üçé',
                                isTack && 'üìå'
                            )
                        );
                    }
                }
                
                return cells;
            };

            return React.createElement('div', {
                style: { 
                    width: '100vw', 
                    height: '100vh', 
                    display: 'flex', 
                    flexDirection: 'column',
                    alignItems: 'center', 
                    justifyContent: 'center',
                    backgroundColor: '#1a1a2e',
                    fontFamily: 'Arial, sans-serif',
                    color: 'white'
                }
            },
                // Î°úÍ∑∏Ïù∏ ÌôîÎ©¥
                gameState === 'login' && React.createElement('div', { 
                    style: { 
                        textAlign: 'center',
                        backgroundColor: '#16213e',
                        padding: '40px',
                        borderRadius: '20px',
                        boxShadow: '0 0 30px rgba(255, 215, 0, 0.3)',
                        minWidth: '400px'
                    } 
                },
                    React.createElement('h1', { 
                        style: { fontSize: '48px', marginBottom: '20px', color: '#FFD700' }
                    }, 'ü¶ù ÎÑàÍµ¨Î¶¨ Í≤åÏûÑ üçé'),
                    React.createElement('h2', { 
                        style: { fontSize: '24px', marginBottom: '30px', color: '#aaa' }
                    }, 'Î°úÍ∑∏Ïù∏'),
                    React.createElement('input', {
                        type: 'text',
                        className: 'input-field',
                        placeholder: 'Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                        value: userName,
                        onChange: (e) => setUserName(e.target.value),
                        onKeyPress: (e) => e.key === 'Enter' && handleLogin()
                    }),
                    React.createElement('input', {
                        type: 'text',
                        className: 'input-field',
                        placeholder: 'ÌïôÎ≤àÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                        value: studentId,
                        onChange: (e) => setStudentId(e.target.value),
                        onKeyPress: (e) => e.key === 'Enter' && handleLogin()
                    }),
                    React.createElement('button', {
                        onClick: handleLogin,
                        style: {
                            width: '100%',
                            padding: '15px',
                            marginTop: '20px',
                            fontSize: '20px',
                            backgroundColor: '#FFD700',
                            border: 'none',
                            borderRadius: '10px',
                            cursor: 'pointer',
                            fontWeight: 'bold',
                            color: '#1a1a2e'
                        }
                    }, 'Î°úÍ∑∏Ïù∏')
                ),

                // Î©îÎâ¥ ÌôîÎ©¥
                gameState === 'menu' && React.createElement('div', { style: { textAlign: 'center' } },
                    React.createElement('div', {
                        style: {
                            position: 'absolute',
                            top: '20px',
                            right: '20px',
                            textAlign: 'right'
                        }
                    },
                        React.createElement('div', { style: { marginBottom: '10px', color: '#FFD700' } },
                            `üë§ ${currentUser.name} (${currentUser.studentId})`
                        ),
                        React.createElement('button', {
                            onClick: handleLogout,
                            style: {
                                padding: '8px 16px',
                                backgroundColor: '#dc2626',
                                color: 'white',
                                border: 'none',
                                borderRadius: '5px',
                                cursor: 'pointer',
                                fontWeight: 'bold'
                            }
                        }, 'Î°úÍ∑∏ÏïÑÏõÉ')
                    ),
                    React.createElement('h1', { 
                        style: { fontSize: '48px', marginBottom: '20px', color: '#FFD700' }
                    }, 'ü¶ù ÎÑàÍµ¨Î¶¨ Í≤åÏûÑ üçé'),
                    React.createElement('p', { 
                        style: { fontSize: '20px', marginBottom: '30px' }
                    }, 'ÏïïÏ†ïÏùÑ ÌîºÌïòÍ≥† Í≥ºÏùºÏùÑ Î™®Îëê Î®πÏúºÏÑ∏Ïöî!'),
                    React.createElement('div', { 
                        style: { marginBottom: '30px', textAlign: 'left', display: 'inline-block' }
                    },
                        React.createElement('p', null, 'ü¶ù ÎÑàÍµ¨Î¶¨: ÌîåÎ†àÏù¥Ïñ¥'),
                        React.createElement('p', null, 'üçé Í≥ºÏùº: 100Ï†ê (Î™®Îëê Î®πÏúºÎ©¥ Îã§Ïùå Ïä§ÌÖåÏù¥ÏßÄ!)'),
                        React.createElement('p', null, 'üìå ÏïïÏ†ï: ÎãøÏúºÎ©¥ ÏÉùÎ™Ö -1'),
                        React.createElement('p', null, '‚å®Ô∏è ÌôîÏÇ¥Ìëú ÌÇ§Î°ú Ï°∞Ïûë')
                    ),
                    React.createElement('br'),
                    React.createElement('div', { style: { display: 'flex', gap: '15px', justifyContent: 'center' } },
                        React.createElement('button', {
                            onClick: startGame,
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#FFD700',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'üéÆ Í≤åÏûÑ ÏãúÏûë'),
                        React.createElement('button', {
                            onClick: showLeaderboard,
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#3b82f6',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: 'white'
                            }
                        }, 'üèÜ ÏàúÏúÑÌëú')
                    )
                ),

                // Í≤åÏûÑ ÌîåÎ†àÏù¥ ÌôîÎ©¥
                gameState === 'playing' && React.createElement('div', null,
                    React.createElement('div', {
                        style: {
                            position: 'absolute',
                            top: '20px',
                            right: '20px',
                            textAlign: 'right',
                            color: '#FFD700'
                        }
                    }, `üë§ ${currentUser.name}`),
                    React.createElement('div', { 
                        style: { 
                            display: 'flex', 
                            justifyContent: 'space-between', 
                            marginBottom: '20px',
                            fontSize: '24px',
                            fontWeight: 'bold'
                        }
                    },
                        React.createElement('div', { style: { display: 'flex', gap: '30px' } },
                            React.createElement('span', null, `‚≠ê Î†àÎ≤®: ${level}`),
                            React.createElement('span', null, `üèÜ Ï†êÏàò: ${score}`),
                            React.createElement('span', null, `‚ù§Ô∏è ÏÉùÎ™Ö: ${lives}`)
                        ),
                        React.createElement('div', null, `üçé ÎÇ®ÏùÄ Í≥ºÏùº: ${fruits.length}`)
                    ),
                    
                    React.createElement('div', { 
                        style: { 
                            display: 'grid', 
                            gridTemplateColumns: `repeat(${GRID_SIZE}, ${CELL_SIZE}px)`,
                            gap: '0',
                            border: '4px solid #FFD700',
                            boxShadow: '0 0 30px rgba(255, 215, 0, 0.5)'
                        }
                    }, renderGrid()),
                    
                    React.createElement('div', { 
                        style: { 
                            marginTop: '20px', 
                            textAlign: 'center',
                            fontSize: '16px',
                            color: '#aaa'
                        }
                    }, '‚å®Ô∏è ÌôîÏÇ¥Ìëú ÌÇ§Î°ú ÎÑàÍµ¨Î¶¨Î•º ÏõÄÏßÅÏù¥ÏÑ∏Ïöî!')
                ),

                // Í≤åÏûÑ Ïò§Î≤Ñ ÌôîÎ©¥
                gameState === 'lost' && React.createElement('div', { style: { textAlign: 'center' } },
                    React.createElement('h1', { style: { fontSize: '48px', color: '#FF6B6B' } }, 'Í≤åÏûÑ Ïò§Î≤Ñ!'),
                    React.createElement('p', { 
                        style: { fontSize: '24px', color: '#FFD700', margin: '20px 0' }
                    }, `ÌîåÎ†àÏù¥Ïñ¥: ${currentUser.name}`),
                    React.createElement('p', { 
                        style: { fontSize: '32px', margin: '30px 0' }
                    }, `ÏµúÏ¢Ö Ï†êÏàò: ${score}`),
                    React.createElement('p', { 
                        style: { fontSize: '24px', marginBottom: '30px' }
                    }, `Î†àÎ≤® ${level}ÍπåÏßÄ ÎèÑÎã¨ÌñàÏäµÎãàÎã§!`),
                    React.createElement('div', { style: { display: 'flex', gap: '15px', justifyContent: 'center' } },
                        React.createElement('button', {
                            onClick: startGame,
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#FFD700',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: '#1a1a2e'
                            }
                        }, 'Îã§Ïãú ÏãúÏûë'),
                        React.createElement('button', {
                            onClick: showLeaderboard,
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#3b82f6',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: 'white'
                            }
                        }, 'ÏàúÏúÑÌëú Î≥¥Í∏∞'),
                        React.createElement('button', {
                            onClick: () => setGameState('menu'),
                            style: {
                                padding: '15px 40px',
                                fontSize: '24px',
                                backgroundColor: '#6b7280',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer',
                                fontWeight: 'bold',
                                color: 'white'
                            }
                        }, 'Î©îÎâ¥Î°ú')
                    )
                ),

                // ÏàúÏúÑÌëú ÌôîÎ©¥
                gameState === 'leaderboard' && React.createElement('div', { 
                    style: { 
                        textAlign: 'center',
                        maxWidth: '800px',
                        width: '90%'
                    } 
                },
                    React.createElement('h1', { 
                        style: { fontSize: '48px', marginBottom: '30px', color: '#FFD700' }
                    }, 'üèÜ ÏàúÏúÑÌëú'),
                    React.createElement('div', { className: 'leaderboard-container' },
                        leaderboard.length === 0 ? 
                            React.createElement('p', { style: { color: '#aaa' } }, 'ÏïÑÏßÅ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.') :
                            leaderboard.map((entry, index) => 
                                React.createElement('div', {
                                    key: entry.id,
                                    className: 'leaderboard-item'
                                },
                                    React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '15px' } },
                                        React.createElement('span', { 
                                            style: { 
                                                fontSize: '24px', 
                                                fontWeight: 'bold',
                                                minWidth: '40px'
                                            } 
                                        }, `${index + 1}ÏúÑ`),
                                        React.createElement('div', { style: { textAlign: 'left' } },
                                            React.createElement('div', { style: { fontSize: '18px' } }, 
                                                `${entry.name} (${entry.studentId})`
                                            ),
                                            React.createElement('div', { style: { fontSize: '14px', opacity: 0.8 } }, 
                                                `Î†àÎ≤® ${entry.level} | ${entry.date}`
                                            )
                                        )
                                    ),
                                    React.createElement('div', { 
                                        style: { 
                                            fontSize: '24px', 
                                            fontWeight: 'bold' 
                                        } 
                                    }, `${entry.score}Ï†ê`)
                                )
                            )
                    ),
                    React.createElement('button', {
                        onClick: () => setGameState('menu'),
                        style: {
                            padding: '15px 40px',
                            marginTop: '30px',
                            fontSize: '24px',
                            backgroundColor: '#FFD700',
                            border: 'none',
                            borderRadius: '10px',
                            cursor: 'pointer',
                            fontWeight: 'bold',
                            color: '#1a1a2e'
                        }
                    }, 'Î©îÎâ¥Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞')
                )
            );
        };

        // React Ïï± Î†åÎçîÎßÅ
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(RaccoonGame));
    </script>
</body>
</html>